(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7581],{17576:(e,r,t)=>{"use strict";t.d(r,{A:()=>n});let n=(0,t(19946).A)("briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]])},18186:(e,r,t)=>{"use strict";t.d(r,{A:()=>n});let n=(0,t(19946).A)("trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]])},26830:(e,r,t)=>{Promise.resolve().then(t.bind(t,83226))},35695:(e,r,t)=>{"use strict";var n=t(18999);t.o(n,"useParams")&&t.d(r,{useParams:function(){return n.useParams}}),t.o(n,"usePathname")&&t.d(r,{usePathname:function(){return n.usePathname}}),t.o(n,"useRouter")&&t.d(r,{useRouter:function(){return n.useRouter}})},41746:(e,r,t)=>{"use strict";t.d(r,{A:()=>n});let n=(0,t(19946).A)("factory",[["path",{d:"M12 16h.01",key:"1drbdi"}],["path",{d:"M16 16h.01",key:"1f9h7w"}],["path",{d:"M3 19a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8.5a.5.5 0 0 0-.769-.422l-4.462 2.844A.5.5 0 0 1 15 10.5v-2a.5.5 0 0 0-.769-.422L9.77 10.922A.5.5 0 0 1 9 10.5V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2z",key:"1iv0i2"}],["path",{d:"M8 16h.01",key:"18s6g9"}]])},51154:(e,r,t)=>{"use strict";t.d(r,{A:()=>n});let n=(0,t(19946).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},55333:(e,r,t)=>{"use strict";t.d(r,{N:()=>a});var n=t(10851);let i="https://whayfpzsmgmxhttztbuw.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndoYXlmcHpzbWdteGh0dHp0YnV3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgxNzM3ODMsImV4cCI6MjA2Mzc0OTc4M30.dj2HhCKz5Eg8dX1_1stQSUeeAHD_wm3i3ldcqthhE3I";if(!i)throw Error("Missing NEXT_PUBLIC_SUPABASE_URL environment variable");if(!o)throw Error("Missing NEXT_PUBLIC_SUPABASE_ANON_KEY environment variable");console.log("Initializing Supabase client with:",{url:i,hasAnonKey:!!o});let a=(0,n.UU)(i,o);!async function(){try{console.log("Testing Supabase connection...");let[{data:e,error:r},{data:t,error:n},{data:i,error:o}]=await Promise.all([a.from("industries").select("count"),a.from("solutions").select("count"),a.from("achievements").select("count")]);console.log("Industries count:",e,"Error:",r),console.log("Solutions count:",t,"Error:",n),console.log("Achievements count:",i,"Error:",o)}catch(e){console.error("Supabase connection test failed:",e)}}()},59434:(e,r,t)=>{"use strict";t.d(r,{cn:()=>o});var n=t(52596),i=t(39688);function o(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,i.QP)((0,n.$)(r))}},70463:(e,r,t)=>{"use strict";t.d(r,{A:()=>n});let n=(0,t(19946).A)("lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]])},83226:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>w});var n=t(95155),i=t(55333),o=t(6874),a=t.n(o),s=t(35695),l=t(59434),c=t(19946);let d=(0,c.A)("layout-dashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);var u=t(41746),h=t(70463),m=t(18186),f=t(17576);let g=(0,c.A)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]),p=[{name:"Dashboard",href:"/admin",icon:d},{name:"Industries",href:"/admin/industries",icon:u.A},{name:"Solutions",href:"/admin/solutions",icon:h.A},{name:"Achievements",href:"/admin/achievements",icon:m.A},{name:"Cases",href:"/admin/cases",icon:f.A}];function y(){let e=(0,s.usePathname)(),r=async()=>{await i.N.auth.signOut(),window.location.href="/auth/login"};return(0,n.jsxs)("div",{className:"flex flex-col w-64 bg-white border-r",children:[(0,n.jsxs)("div",{className:"flex-1 flex flex-col pt-5 pb-4 overflow-y-auto",children:[(0,n.jsx)("div",{className:"flex items-center flex-shrink-0 px-4",children:(0,n.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"Admin Panel"})}),(0,n.jsx)("nav",{className:"mt-8 flex-1 px-2 space-y-1",children:p.map(r=>{let t=e===r.href;return(0,n.jsxs)(a(),{href:r.href,className:(0,l.cn)("group flex items-center px-2 py-2 text-sm font-medium rounded-md",t?"bg-gray-100 text-gray-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,n.jsx)(r.icon,{className:(0,l.cn)("mr-3 h-5 w-5",t?"text-gray-500":"text-gray-400 group-hover:text-gray-500")}),r.name]},r.name)})})]}),(0,n.jsx)("div",{className:"flex-shrink-0 flex border-t p-4",children:(0,n.jsxs)("button",{onClick:r,className:"flex-shrink-0 w-full group flex items-center px-2 py-2 text-sm font-medium text-red-600 hover:bg-red-50 rounded-md",children:[(0,n.jsx)(g,{className:"mr-3 h-5 w-5"}),"Sign Out"]})})]})}var x=t(12115);async function v(){try{let{data:{session:e}}=await i.N.auth.getSession();if(!(null==e?void 0:e.user))return console.log("No session found"),!1;console.log("Checking admin role for user:",e.user.id);let{data:r,error:t}=await i.N.from("profiles").select("*").eq("id",e.user.id).single();if(t){if(console.error("Error checking profile:",t),"PGRST116"===t.code){console.log("Profile not found, creating new profile");let{error:r}=await i.N.from("profiles").insert({id:e.user.id,role:"admin"});if(r)return console.error("Error creating profile:",r),!1;return!0}return!1}if(console.log("Current profile:",r),!r||"admin"!==r.role){console.log("Updating profile to admin role");let{error:r}=await i.N.from("profiles").upsert({id:e.user.id,role:"admin"});if(r)return console.error("Error setting admin role:",r),!1;let{data:t,error:n}=await i.N.from("profiles").select("role").eq("id",e.user.id).single();if(n||(null==t?void 0:t.role)!=="admin")return console.error("Failed to verify admin role:",n),!1;console.log("Successfully set admin role")}return!0}catch(e){return console.error("Error in checkAndSetAdminRole:",e),!1}}var N=t(51154);function w(e){let{children:r}=e,[t,o]=(0,x.useState)(!0),[a,l]=(0,x.useState)(!1),c=(0,s.usePathname)(),d=(0,s.useRouter)();return((0,x.useEffect)(()=>{if("/admin/login"===c)return void o(!1);let e=!0;!async function(){try{let{data:{session:r}}=await i.N.auth.getSession();if(!(null==r?void 0:r.user)){console.log("No session found, redirecting to login"),d.push("/admin/login");return}if(!await v()){console.log("Not an admin, redirecting to login"),d.push("/admin/login");return}e&&(console.log("Admin role confirmed"),l(!0),o(!1))}catch(r){console.error("Error checking auth:",r),e&&d.push("/admin/login")}finally{e&&o(!1)}}();let{data:{subscription:r}}=i.N.auth.onAuthStateChange(async r=>{if(e)if("SIGNED_IN"===r){let e=await v();l(e),e||d.push("/admin/login")}else"SIGNED_OUT"===r&&(l(!1),d.push("/admin/login"))});return()=>{e=!1,r.unsubscribe()}},[c,d]),"/admin/login"===c)?r:t?(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,n.jsx)(N.A,{className:"w-8 h-8 animate-spin"})}):a?(0,n.jsxs)("div",{className:"flex min-h-screen",children:[(0,n.jsx)(y,{}),(0,n.jsx)("main",{className:"flex-1 p-8",children:r})]}):null}}},e=>{var r=r=>e(e.s=r);e.O(0,[4277,8852,6874,8441,1684,7358],()=>r(26830)),_N_E=e.O()}]);